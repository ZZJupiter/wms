# WMS 高效汇波分拣方案

业务诉求: 仓库接收到100万单同品同件的发货单,需要在30分钟内完成汇波,生成拣选单.

下面引入一个获取UUID方案的例子,类比下仓库库存分配.

## UUID获取方案

<img src="https://tva1.sinaimg.cn/large/008i3skNly1grtihq1nklj30l50kz40s.jpg" alt="UUID生成服务" style="zoom:150%;" />

与UUID获取类似,100万订单相当要获取UUID的Client,获取到的UUID相当于发货单占用的库位库存.



## 汇波分拣分案(仅生成单据)

汇波分拣流程如下:

### 创建汇波单

* 创建汇波单,并记录查询条件
* 根据查询条件过滤出所有的发货单,并标记所属的汇波单.
* 统计加入到汇波单中的发货单数量,需要占用的总库存数

### 根据查询条件过滤出符合条件的发货单

* 根据加入到汇波单中的发货单数量,计算要生成拣选单的数量,创建相应数量的拣选单,并标注需要拣选的发货单数量
* 分页查询出发货,并将发货单关联到拣选单,同时计算拣选单需要占用的库存数量,直到关联的发货单数量满足预期关联的数量为止
* 所有拣选单关联发货单结束后,统计所有拣选单需要占用的库存总数,与之前更新到汇波单的需要占用的总库存数做校验.

### 占用库位库存

* 根据汇波单中需要占用的库存总数,一次性锁定库存.
* 将锁定的库位库存按拣选单的维度进行拆分,如果有1000个拣选单,拆分成至少1000条库位库存记录(之前的库位库存可能被多个拣选单瓜分),标记所属拣选单
* 对每个拣选单中的发货单,在新拆分出的库位库存记录上做发货单级别的库位库存占用.



<img src="https://tva1.sinaimg.cn/large/008i3skNly1grub9xpkxoj30js0cb40n.jpg" alt="汇波分拣-高并发" style="zoom:150%;" />

## 灵魂拷问

问题: 仓库对单品单件的发货单,大批量作业时,是集中作业,还是分散作业?是摘果还是播种?

答复: 实际仓库对无差别的订单(品类和件数基本一致,收货人可以不同),当数据较大时,采用集中作业方式,一般选择播种.

例如: 某仓储作业的同学,接收到一个有500个发货单的拣选任务,每个发货单的明细相同,口红1一支.他的操作流程是,到指定库位取N箱口红(可能大于500支),到分拣区,占用一个分拣容器(可能是10 x 10 的格子),每个格子放一只,放好后,送复核打包,贴面单,如此往复...

那么问题来了,库存占用需要明确到某一个发货单的占用吗?????

